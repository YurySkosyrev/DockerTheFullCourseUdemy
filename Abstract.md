## Введение ##
Docker - сервис для запуска приложений в контейнерах

Преимущества Docker:
- приложения запускаются в **изолированной среде**
- легко запускать приложения на **разных** серверах 
- все зависимости приложений устанавливаются **внутри контейнеров**
- легко масштабировать путем увеличения количества **контейнеров**
- удобно использовать в процессе **разработки** приложений

## Основные понятия ##
_**Container**_ - самый маленький элемент в Docker (Single propose)

_**Client**_ - запускается в командной строке для подключения к **службе** Docker (локальной или удалённой)

_**Deamon**_ - **служба**, которая создает **Containers** и обрабатывает запросы от клиента

_**Host**_ - компьютер, на котором запущен Docker

_**Image**_ - основа для создания **Container**, из одного **Image** можно создать много **Container**

_**Repository**_ - в нём находятся различные версии **Image**

_**Registry**_ - реестр в нём находятся различние версии Repository (локальные или удалённые - DockerHub)

## Container ##

Для создания **Container** необходим Docker Engine, который запускает Docker Deamon

Для **Container** создается изолированное место на жестком диске, где хранятся файлы для **Container**, 
а также в **Container** запускаются изолированные процессы.

Чаще всего запускается один процесс.

Все ресурсы у **Containers** общие (RAM, CPU, Network).

При создании нескольких **Container** с одного **Image**, общие файлы будут хранится в каком-то одном месте,
а не в каждом **Container**

После остановки **Container** все его файлы удаляются.

Docker автоматически останавливает все **Container**, у которых нет активных процессов.

## Image ##

**Image** - набор файлов и инструкций. **Image** - статичен

**Image** состоит из слоёв (FileSystemLayers), у каждого образа есть базовый слой.
Слои состоят из файлов.

Слойность нужна для переиспользования в разных **Image** и ускорения создания Custom Image

- Все слои **read-only**
- **Images** можно **перемещать** и **удалять**
- **Images** хранятся в **Repository**, в одном **Repository** может хранится несколько версий **Image**
- Есть официальные **Image** и образы сообществ

## Repository ##

**Repository** - аналог GitHub. В нём хранятся различные версии **Image** с различными тэгами.

Тэги:
- **latest** - последняя версия
- **alpine** - самая легковесная версия **Image**

## Создание собственного Image ##

Этапы создания **Image**:
- Dockerfile - инструкции для создания **Image**, один файл для одного **Image**
- обычно Dockerfile помещают в корне папки приложения
- при создании **Image** можно указать имя и тэг

Всегда указывается базовый **Image** и все собственные слои добавляются к базовому

пример Dockerfile:

имя:тэг базового образа

**FROM python:alpine**

создаём рабочую директорую внутри **Image**, рекомендуется всегда создавать 
отдельную папку и не копировать приложение в корень образа


**WORKDIR /app**


копируем файлы из пути относительно рабочей директории в путь относительно WORKDIR

**COPY . .**


команда, которая будет выполнена при создании нового **Container**

CMD ["python", "main.py"] 

## Docker compose ##

**Docker compose** позволяет запускать и останавливать несколько контейнеров, используя одну команду

Имеративный подход - пользователь вводит команды Docker в терминале (build, run etc.)

Декларативный подход - абстрагируемся от отдельных команд Docker и с помощью инструкции более высого уровня описыается конечное состояние.
Инструкции записываются в yaml - файл.

Формат YAML:
- список

  fruits:
  - - banana
  - - apple
  - - orange

- словарь

  pen:
    - color: yellow
    - model:
      - type: pen
      - material: plastic
    - price: 2

В yaml большое значение имеют отступы. Один отступ - 2 пробела.

Преимущества **Docker Compose**:
- **Декларативный** подход к созданию контейнеров
- Все необходимые контейнеры запускаются **одной командой**
- Автоматическое создание необходимых образов на основании **Dockerfile** каждого приложения
- Автоматическое создание изолированной **сети** для взаимодействия контейнеров
- Благодаря **DNS** возможно взаимодействие между контейнерами, используя **имена сервисов**
То есть имена сервисов статичные, а IP динамичный.

Синтаксис в yaml-файле:

Переменные среды environment можно задавать в виде списка, либо словаря.

version: '3'

services:

  - frontend:
    - build: ./frontend
    - ports:
      - -'3333:3000'
  - api:
    - build: ./api
    - ports:
      - -'5555:5000'
  - mysql:
    - image: mysql
    - environment:
    - MYSQL_ROOT_PASSWORD: password
    - MYSQL_DATABASE: time_db
  - adminer:
    - image: adminer
    - ports:
      - -'8888:8000'

Подключение тома внутри Docker Host:

version: '3'

services:

  - mysql:
    - image: mysql
    - volumes: 
      --mysql_data:/var/lib/mysql

volumes:

  - mysql_data:
